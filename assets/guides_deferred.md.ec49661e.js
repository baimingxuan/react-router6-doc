import{_ as s,o as a,c as n,Q as l}from"./chunks/framework.6f0990a9.js";const u=JSON.parse('{"title":"å»¶è¿Ÿæ•°æ®æŒ‡å—","description":"","frontmatter":{},"headers":[],"relativePath":"guides/deferred.md","filePath":"guides/deferred.md","lastUpdated":1699451704000}'),p={name:"guides/deferred.md"},o=l(`<h1 id="å»¶è¿Ÿæ•°æ®æŒ‡å—" tabindex="-1">å»¶è¿Ÿæ•°æ®æŒ‡å— <a class="header-anchor" href="#å»¶è¿Ÿæ•°æ®æŒ‡å—" aria-label="Permalink to &quot;å»¶è¿Ÿæ•°æ®æŒ‡å—&quot;">â€‹</a></h1><h2 id="é—®é¢˜" tabindex="-1">é—®é¢˜ <a class="header-anchor" href="#é—®é¢˜" aria-label="Permalink to &quot;é—®é¢˜&quot;">â€‹</a></h2><p>æƒ³è±¡ä¸€ä¸‹è¿™æ ·ä¸€ç§åœºæ™¯ï¼šæ‚¨çš„æŸä¸ªè·¯å¾„<code>loader</code>éœ€è¦æ£€ç´¢ä¸€äº›æ•°æ®ï¼Œè€Œç”±äºæŸç§åŸå› ï¼Œæ£€ç´¢é€Ÿåº¦ç›¸å½“æ…¢ã€‚ä¾‹å¦‚ï¼Œæ‚¨è¦å‘ç”¨æˆ·æ˜¾ç¤ºä¸€ä¸ªåŒ…è£¹çš„ä½ç½®ï¼Œè¯¥åŒ…è£¹æ­£è¢«é€å¾€ç”¨æˆ·å®¶ä¸­ï¼š</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { json, useLoaderData } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;react-router-dom&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { getPackageLocation } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./api/packages&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">packageLocation</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getPackageLocation</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    params.packageId</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">({ packageLocation });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PackageRoute</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useLoaderData</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> { </span><span style="color:#79B8FF;">packageLocation</span><span style="color:#E1E4E8;"> } </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> data;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        Your package is at {packageLocation.latitude} lat</span></span>
<span class="line"><span style="color:#E1E4E8;">        and {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { json, useLoaderData } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;react-router-dom&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { getPackageLocation } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./api/packages&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">params</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">packageLocation</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getPackageLocation</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    params.packageId</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">({ packageLocation });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PackageRoute</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useLoaderData</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> { </span><span style="color:#005CC5;">packageLocation</span><span style="color:#24292E;"> } </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> data;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">        Your package is at {packageLocation.latitude} lat</span></span>
<span class="line"><span style="color:#24292E;">        and {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æˆ‘ä»¬å‡è®¾ <code>getPackageLocation</code> é€Ÿåº¦è¾ƒæ…¢ã€‚è¿™å°†å¯¼è‡´åˆå§‹é¡µé¢åŠ è½½æ—¶é—´å’Œè·¯å¾„è½¬æ¢æ—¶é—´ä¸æœ€æ…¢çš„æ•°æ®ä¸€æ ·é•¿ã€‚æœ‰å‡ ç§æ–¹æ³•å¯ä»¥ä¼˜åŒ–è¿™ç§æƒ…å†µå¹¶æ”¹å–„ç”¨æˆ·ä½“éªŒï¼š</p><ul><li>è®©ç¼“æ…¢çš„äº‹æƒ…åŠ é€Ÿï¼ˆğŸ˜…ï¼‰ã€‚</li><li>ä½¿ç”¨ <code>Promise.all</code> å®ç°æ•°æ®åŠ è½½çš„å¹¶è¡ŒåŒ–ï¼ˆåœ¨æˆ‘ä»¬çš„ç¤ºä¾‹ä¸­æ²¡æœ‰ä»€ä¹ˆéœ€è¦å¹¶è¡ŒåŒ–çš„ï¼Œä½†åœ¨å…¶ä»–æƒ…å†µä¸‹å¯èƒ½ä¼šæœ‰ç‚¹å¸®åŠ©ï¼‰ã€‚</li><li>æ·»åŠ å…¨å±€è¿‡æ¸¡æ—‹è½¬å™¨ï¼ˆå¯¹ç”¨æˆ·ä½“éªŒæœ‰ä¸€å®šå¸®åŠ©ï¼‰ã€‚</li><li>æ·»åŠ æœ¬åœ°åŒ–çš„éª¨æ¶ç”¨æˆ·ç•Œé¢ï¼ˆå¯¹ç”¨æˆ·ä½“éªŒæœ‰ä¸€å®šå¸®åŠ©ï¼‰ã€‚</li></ul><p>å¦‚æœè¿™äº›æ–¹æ³•æ•ˆæœä¸ä½³ï¼Œé‚£ä¹ˆæ‚¨å¯èƒ½ä¸å¾—ä¸å°†æ…¢é€Ÿæ•°æ®ä» <code>loader</code> ç§»åˆ°ç»„ä»¶è·å–ä¸­ï¼ˆå¹¶åœ¨åŠ è½½æ—¶æ˜¾ç¤ºéª¨æ¶å›é€€ UIï¼‰ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨éœ€è¦åœ¨æŒ‚è½½æ—¶æ¸²æŸ“åå¤‡ UIï¼Œç„¶åå¯åŠ¨æ•°æ®è·å–ã€‚ä» DX çš„è§’åº¦æ¥çœ‹ï¼Œè¿™å…¶å®å¹¶ä¸å¯æ€•ï¼Œè¿™è¦å½’åŠŸäº<a href="https://baimingxuan.github.io/react-router6-doc/hooks/use-fetcher" target="_blank" rel="noreferrer"><code>useFetcher</code></a>ã€‚ä»ç”¨æˆ·ä½“éªŒçš„è§’åº¦æ¥çœ‹ï¼Œè¿™æ”¹å–„äº†å®¢æˆ·ç«¯è½¬æ¢å’Œåˆå§‹é¡µé¢åŠ è½½çš„åŠ è½½ä½“éªŒã€‚å› æ­¤ï¼Œè¿™ä¼¼ä¹ç¡®å®è§£å†³äº†é—®é¢˜ã€‚</p><p>ä½†ç”±äºä»¥ä¸‹ä¸¤ä¸ªåŸå› ï¼Œåœ¨å¤§å¤šæ•°æƒ…å†µä¸‹ï¼ˆå°¤å…¶æ˜¯åœ¨å¯¹è·¯ç”±ç»„ä»¶è¿›è¡Œä»£ç æ‹†åˆ†çš„æƒ…å†µä¸‹ï¼‰ï¼Œå®ƒä»ç„¶ä¸æ˜¯æœ€ä½³é€‰æ‹©ï¼š</p><ol><li>å®¢æˆ·ç«¯è·å–å°†æ•°æ®è¯·æ±‚ç½®äºç€‘å¸ƒå¼æµç¨‹ä¸­ï¼šæ–‡æ¡£ -&gt; JavaScript -&gt; æ‡’åŠ è½½è·¯ç”± -&gt; æ•°æ®è·å–</li><li>æ‚¨çš„ä»£ç æ— æ³•åœ¨ç»„ä»¶è·å–å’Œè·¯ç”±è·å–ä¹‹é—´è½»æ¾åˆ‡æ¢ï¼ˆç¨åå°†è¯¦ç»†ä»‹ç»ï¼‰ã€‚</li></ol><h2 id="è§£å†³æ–¹æ¡ˆ" tabindex="-1">è§£å†³æ–¹æ¡ˆ <a class="header-anchor" href="#è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;è§£å†³æ–¹æ¡ˆ&quot;">â€‹</a></h2><p>React Router ä½¿ç”¨ <a href="https://baimingxuan.github.io/react-router6-doc/utils/defer" target="_blank" rel="noreferrer"><code>defer</code>å“åº”</a> å®ç”¨ç¨‹åºå’Œ <a href="https://baimingxuan.github.io/react-router6-doc/components/await" target="_blank" rel="noreferrer"><code>&lt;Await /&gt;</code></a> ç»„ä»¶/<a href="https://baimingxuan.github.io/react-router6-doc/hooks/use-async-value" target="_blank" rel="noreferrer"><code>useAsyncValue</code></a> é’©å­ï¼Œå¹¶åˆ©ç”¨ React 18 çš„ Suspense æ¥è·å–æ•°æ®ã€‚é€šè¿‡ä½¿ç”¨è¿™äº› APIï¼Œæ‚¨å¯ä»¥è§£å†³è¿™ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li>æ‚¨çš„æ•°æ®ä¸å†æ˜¯ç€‘å¸ƒå¼çš„ï¼šæ–‡æ¡£ -&gt; JavaScript -&gt; æ‡’åŠ è½½è·¯å¾„å’Œæ•°æ®ï¼ˆå¹¶è¡Œï¼‰ã€‚</li><li>æ‚¨çš„ä»£ç å¯ä»¥åœ¨æ¸²æŸ“å›é€€å’Œç­‰å¾…æ•°æ®ä¹‹é—´è½»æ¾åˆ‡æ¢</li></ol><p>è®©æˆ‘ä»¬æ·±å…¥äº†è§£ä¸€ä¸‹å¦‚ä½•åšåˆ°è¿™ä¸€ç‚¹ã€‚</p><h3 id="ä½¿ç”¨defer" tabindex="-1">ä½¿ç”¨<code>defer</code> <a class="header-anchor" href="#ä½¿ç”¨defer" aria-label="Permalink to &quot;ä½¿ç”¨\`defer\`&quot;">â€‹</a></h3><p>é¦–å…ˆï¼Œä¸ºæ‚¨çš„æ…¢é€Ÿæ•°æ®è¯·æ±‚æ·»åŠ  <code>&lt;Await /&gt;</code> ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨æ›´å¸Œæœ›å‘ˆç°ä¸€ä¸ªå›è°ƒ UIã€‚è®©æˆ‘ä»¬åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­è¿™æ ·åšï¼š</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">  Await,</span></span>
<span class="line"><span style="color:#E1E4E8;">  defer,</span></span>
<span class="line"><span style="color:#E1E4E8;">  useLoaderData,</span></span>
<span class="line"><span style="color:#E1E4E8;">} </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;react-router-dom&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"><span style="color:#F97583;">import</span><span style="color:#E1E4E8;"> { getPackageLocation } </span><span style="color:#F97583;">from</span><span style="color:#E1E4E8;"> </span><span style="color:#9ECBFF;">&quot;./api/packages&quot;</span><span style="color:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">packageLocationPromise</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getPackageLocation</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    params.packageId</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defer</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    packageLocation: packageLocationPromise,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PackageRoute</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useLoaderData</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#79B8FF;">React.Suspense</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">fallback</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{&lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;Loading package location...&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;}</span></span>
<span class="line"><span style="color:#E1E4E8;">      &gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#79B8FF;">Await</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">resolve</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{data.packageLocation}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">errorElement</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;Error loading package location!&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        &gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          {(</span><span style="color:#FFAB70;">packageLocation</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">              Your package is at {packageLocation.latitude}{</span><span style="color:#9ECBFF;">&quot; &quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">              lat and {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          )}</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#79B8FF;">Await</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#79B8FF;">React.Suspense</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">  Await,</span></span>
<span class="line"><span style="color:#24292E;">  defer,</span></span>
<span class="line"><span style="color:#24292E;">  useLoaderData,</span></span>
<span class="line"><span style="color:#24292E;">} </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;react-router-dom&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"><span style="color:#D73A49;">import</span><span style="color:#24292E;"> { getPackageLocation } </span><span style="color:#D73A49;">from</span><span style="color:#24292E;"> </span><span style="color:#032F62;">&quot;./api/packages&quot;</span><span style="color:#24292E;">;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">params</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">packageLocationPromise</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getPackageLocation</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    params.packageId</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defer</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    packageLocation: packageLocationPromise,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PackageRoute</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useLoaderData</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#005CC5;">React.Suspense</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">fallback</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{&lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;Loading package location...&lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;}</span></span>
<span class="line"><span style="color:#24292E;">      &gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#005CC5;">Await</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">resolve</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{data.packageLocation}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">errorElement</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;Error loading package location!&lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        &gt;</span></span>
<span class="line"><span style="color:#24292E;">          {(</span><span style="color:#E36209;">packageLocation</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">              Your package is at {packageLocation.latitude}{</span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">              lat and {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#24292E;">            &lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          )}</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#005CC5;">Await</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#005CC5;">React.Suspense</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æˆ–è€…ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ <code>useAsyncValue</code> é’©å­ï¼š</p><p>å¦‚æœä½ ä¸å–œæ¬¢ä½¿ç”¨ render å±æ€§ï¼Œä½ å¯ä»¥ä½¿ç”¨ä¸€ä¸ª Hookï¼Œä½†ä½ å¿…é¡»æŠŠä»£ç æ‹†åˆ†æˆå¦ä¸€ä¸ªç»„ä»¶ï¼š</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">export</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">default</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PackageRoute</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">data</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useLoaderData</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#85E89D;">h1</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;</span><span style="color:#79B8FF;">React.Suspense</span></span>
<span class="line"><span style="color:#E1E4E8;">        </span><span style="color:#B392F0;">fallback</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{&lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;Loading package location...&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;}</span></span>
<span class="line"><span style="color:#E1E4E8;">      &gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;</span><span style="color:#79B8FF;">Await</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">resolve</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{data.packageLocation}</span></span>
<span class="line"><span style="color:#E1E4E8;">          </span><span style="color:#B392F0;">errorElement</span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;">{</span></span>
<span class="line"><span style="color:#E1E4E8;">            &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;Error loading package location!&lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          }</span></span>
<span class="line"><span style="color:#E1E4E8;">        &gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">          &lt;</span><span style="color:#79B8FF;">PackageLocation</span><span style="color:#E1E4E8;"> /&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">        &lt;/</span><span style="color:#79B8FF;">Await</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      &lt;/</span><span style="color:#79B8FF;">React.Suspense</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">main</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">PackageLocation</span><span style="color:#E1E4E8;">() {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">packageLocation</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">useAsyncValue</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> (</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">      Your package is at {packageLocation.latitude} lat and{</span><span style="color:#9ECBFF;">&quot; &quot;</span><span style="color:#E1E4E8;">}</span></span>
<span class="line"><span style="color:#E1E4E8;">      {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#E1E4E8;">    &lt;/</span><span style="color:#85E89D;">p</span><span style="color:#E1E4E8;">&gt;</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">export</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">default</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PackageRoute</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">data</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useLoaderData</span><span style="color:#24292E;">();</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;Let&#39;s locate your package&lt;/</span><span style="color:#22863A;">h1</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;</span><span style="color:#005CC5;">React.Suspense</span></span>
<span class="line"><span style="color:#24292E;">        </span><span style="color:#6F42C1;">fallback</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{&lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;Loading package location...&lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;}</span></span>
<span class="line"><span style="color:#24292E;">      &gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;</span><span style="color:#005CC5;">Await</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">resolve</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{data.packageLocation}</span></span>
<span class="line"><span style="color:#24292E;">          </span><span style="color:#6F42C1;">errorElement</span><span style="color:#D73A49;">=</span><span style="color:#24292E;">{</span></span>
<span class="line"><span style="color:#24292E;">            &lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;Error loading package location!&lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">          }</span></span>
<span class="line"><span style="color:#24292E;">        &gt;</span></span>
<span class="line"><span style="color:#24292E;">          &lt;</span><span style="color:#005CC5;">PackageLocation</span><span style="color:#24292E;"> /&gt;</span></span>
<span class="line"><span style="color:#24292E;">        &lt;/</span><span style="color:#005CC5;">Await</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      &lt;/</span><span style="color:#005CC5;">React.Suspense</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">main</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">PackageLocation</span><span style="color:#24292E;">() {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">packageLocation</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">useAsyncValue</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> (</span></span>
<span class="line"><span style="color:#24292E;">    &lt;</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">      Your package is at {packageLocation.latitude} lat and{</span><span style="color:#032F62;">&quot; &quot;</span><span style="color:#24292E;">}</span></span>
<span class="line"><span style="color:#24292E;">      {packageLocation.longitude} long.</span></span>
<span class="line"><span style="color:#24292E;">    &lt;/</span><span style="color:#22863A;">p</span><span style="color:#24292E;">&gt;</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><h2 id="è¯„ä¼°è§£å†³æ–¹æ¡ˆ" tabindex="-1">è¯„ä¼°è§£å†³æ–¹æ¡ˆ <a class="header-anchor" href="#è¯„ä¼°è§£å†³æ–¹æ¡ˆ" aria-label="Permalink to &quot;è¯„ä¼°è§£å†³æ–¹æ¡ˆ&quot;">â€‹</a></h2><p>å› æ­¤ï¼Œæˆ‘ä»¬ä¸ä¼šåœ¨è§¦å‘è·å–è¯·æ±‚å‰ç­‰å¾…ç»„ä»¶ï¼Œè€Œæ˜¯åœ¨ç”¨æˆ·å¼€å§‹è½¬æ¢åˆ°æ–°è·¯ç”±æ—¶ï¼Œç«‹å³å¯åŠ¨å¯¹æ…¢é€Ÿæ•°æ®çš„è¯·æ±‚ã€‚è¿™å¯ä»¥å¤§å¤§åŠ å¿«è¾ƒæ…¢ç½‘ç»œçš„ç”¨æˆ·ä½“éªŒã€‚</p><p>æ­¤å¤–ï¼ŒReact Router ä¸ºæ­¤æä¾›çš„ API éå¸¸äººæ€§åŒ–ã€‚æ‚¨å¯ä»¥æ ¹æ®æ˜¯å¦åŒ…å« <code>await</code> å…³é”®å­—ï¼Œåœ¨æ˜¯å¦å»¶è¿Ÿä¹‹é—´è¿›è¡Œåˆ‡æ¢ï¼š</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defer</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// not deferred:</span></span>
<span class="line"><span style="color:#E1E4E8;">  packageLocation: </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> packageLocationPromise,</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#6A737D;">// deferred:</span></span>
<span class="line"><span style="color:#E1E4E8;">  packageLocation: packageLocationPromise,</span></span>
<span class="line"><span style="color:#E1E4E8;">});</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defer</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// not deferred:</span></span>
<span class="line"><span style="color:#24292E;">  packageLocation: </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> packageLocationPromise,</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#6A737D;">// deferred:</span></span>
<span class="line"><span style="color:#24292E;">  packageLocation: packageLocationPromise,</span></span>
<span class="line"><span style="color:#24292E;">});</span></span></code></pre></div><p>å› æ­¤ï¼Œæ‚¨å¯ä»¥è¿›è¡Œ A/B å»¶è¿Ÿæµ‹è¯•ï¼Œç”šè‡³å¯ä»¥æ ¹æ®ç”¨æˆ·æˆ–è¯·æ±‚çš„æ•°æ®æ¥å†³å®šæ˜¯å¦å»¶è¿Ÿï¼š</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">request</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">packageLocationPromise</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">getPackageLocation</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    params.packageId</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">const</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">shouldDefer</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">shouldDeferPackageLocation</span><span style="color:#E1E4E8;">(</span></span>
<span class="line"><span style="color:#E1E4E8;">    request,</span></span>
<span class="line"><span style="color:#E1E4E8;">    params.packageId</span></span>
<span class="line"><span style="color:#E1E4E8;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defer</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    packageLocation: shouldDefer</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">?</span><span style="color:#E1E4E8;"> packageLocationPromise</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">:</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">await</span><span style="color:#E1E4E8;"> packageLocationPromise,</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">request</span><span style="color:#24292E;">, </span><span style="color:#E36209;">params</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">packageLocationPromise</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">getPackageLocation</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    params.packageId</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">const</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">shouldDefer</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">shouldDeferPackageLocation</span><span style="color:#24292E;">(</span></span>
<span class="line"><span style="color:#24292E;">    request,</span></span>
<span class="line"><span style="color:#24292E;">    params.packageId</span></span>
<span class="line"><span style="color:#24292E;">  );</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defer</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    packageLocation: shouldDefer</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">?</span><span style="color:#24292E;"> packageLocationPromise</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">:</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">await</span><span style="color:#24292E;"> packageLocationPromise,</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p><code>shouldDeferPackageLocation</code> å¯ä»¥ç”¨æ¥æ£€æŸ¥æå‡ºè¯·æ±‚çš„ç”¨æˆ·ã€è½¯ä»¶åŒ…ä½ç½®æ•°æ®æ˜¯å¦åœ¨ç¼“å­˜ä¸­ã€A/B æµ‹è¯•çš„çŠ¶æ€æˆ–å…¶ä»–ä»»ä½•ä½ æƒ³è¦çš„ä¿¡æ¯ã€‚è¿™çœŸæ˜¯å¤ªè´´å¿ƒäº† ğŸ­</p><h2 id="å¸¸é—®é—®é¢˜" tabindex="-1">å¸¸é—®é—®é¢˜ <a class="header-anchor" href="#å¸¸é—®é—®é¢˜" aria-label="Permalink to &quot;å¸¸é—®é—®é¢˜&quot;">â€‹</a></h2><h3 id="ä¸ºä»€ä¹ˆä¸é»˜è®¤æ¨è¿Ÿä¸€åˆ‡" tabindex="-1">ä¸ºä»€ä¹ˆä¸é»˜è®¤æ¨è¿Ÿä¸€åˆ‡ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆä¸é»˜è®¤æ¨è¿Ÿä¸€åˆ‡" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆä¸é»˜è®¤æ¨è¿Ÿä¸€åˆ‡ï¼Ÿ&quot;">â€‹</a></h3><p>eact Router defer API æ˜¯ React Router æä¾›çš„å¦ä¸€ä¸ªå·¥å…·ï¼Œå®ƒä¸ºæ‚¨æä¾›äº†ä¸€ç§åœ¨æƒè¡¡ä¹‹é—´åšå‡ºé€‰æ‹©çš„å¥½æ–¹æ³•ã€‚ä½ æƒ³è®©é¡µé¢æ¸²æŸ“å¾—æ›´å¿«å—ï¼Ÿé‚£å°±å»¶è¿Ÿå§ã€‚ä½ æƒ³è¦æ›´ä½çš„ CLSï¼ˆå†…å®¹å¸ƒå±€åç§»ï¼‰ï¼Ÿä¸è¦å»¶è¿Ÿã€‚ä½ æƒ³è¦æ›´å¿«çš„æ¸²æŸ“é€Ÿåº¦ï¼Œä½†ä¹Ÿæƒ³è¦æ›´ä½çš„ CLSï¼Ÿé‚£å°±åªå»¶è¿Ÿé‚£äº›æ…¢ä¸”ä¸é‡è¦çš„å†…å®¹ã€‚</p><p>è¿™éƒ½æ˜¯æƒè¡¡çš„ç»“æœï¼Œè€Œ API è®¾è®¡çš„ç²¾å¦™ä¹‹å¤„åœ¨äºï¼Œå®ƒéå¸¸é€‚åˆä½ è¿›è¡Œç®€å•çš„å®éªŒï¼Œçœ‹çœ‹å“ªç§æƒè¡¡æ–¹å¼èƒ½ä¸ºä½ çš„çœŸå®ä¸–ç•Œå…³é”®æŒ‡æ ‡å¸¦æ¥æ›´å¥½çš„ç»“æœã€‚</p><h3 id="suspense-å›é€€ä½•æ—¶æ¸²æŸ“" tabindex="-1"><code>&lt;Suspense/&gt;</code>å›é€€ä½•æ—¶æ¸²æŸ“ï¼Ÿ <a class="header-anchor" href="#suspense-å›é€€ä½•æ—¶æ¸²æŸ“" aria-label="Permalink to &quot;\`&lt;Suspense/&gt;\`å›é€€ä½•æ—¶æ¸²æŸ“ï¼Ÿ&quot;">â€‹</a></h3><p><code>&lt;Await /&gt;</code> ç»„ä»¶åªä¼šåœ¨åˆå§‹å‘ˆç° <code>&lt;Await /&gt;</code> ç»„ä»¶æ—¶ï¼Œåœ¨ <code>&lt;Suspense&gt;</code> è¾¹ç•Œä¸ŠæŠ›å‡º<code>promise</code>ï¼Œä¸”<code>promise</code>æœªç¡®å®šã€‚å¦‚æœå±æ€§å‘ç”Ÿå˜åŒ–ï¼Œå®ƒä¸ä¼šé‡æ–°æ¸²æŸ“å›è°ƒã€‚å®é™…ä¸Šï¼Œè¿™æ„å‘³ç€å½“ç”¨æˆ·æäº¤è¡¨å•å¹¶é‡æ–°éªŒè¯<code>loader</code>æ•°æ®æ—¶ï¼Œä¸ä¼šå‘ˆç°å›è°ƒã€‚å½“ç”¨æˆ·ä½¿ç”¨ä¸åŒçš„å‚æ•°å¯¼èˆªåˆ°ç›¸åŒçš„è·¯å¾„æ—¶ï¼ˆåœ¨ä¸Šè¿°ç¤ºä¾‹ä¸­ï¼Œå¦‚æœç”¨æˆ·ä»å·¦ä¾§çš„å¥—é¤åˆ—è¡¨ä¸­é€‰æ‹©åœ¨å³ä¾§æ‰¾åˆ°è‡ªå·±çš„ä½ç½®ï¼‰ï¼Œå°±ä¼šå‘ˆç°å›è°ƒã€‚</p><p>ä¸€å¼€å§‹ï¼Œæˆ‘ä»¬å¯èƒ½ä¼šè§‰å¾—è¿™ä¸ç›´è§‰ç›¸æ‚–ï¼Œä½†è¯·åˆ«æ€¥ï¼Œæˆ‘ä»¬å·²ç»ä»”ç»†è€ƒè™‘è¿‡è¿™ä¸ªé—®é¢˜ï¼Œè€Œä¸”è¿™ç§å·¥ä½œæ–¹å¼éå¸¸é‡è¦ã€‚è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹æ²¡æœ‰å»¶è¿Ÿ API çš„ä¸–ç•Œã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œæ‚¨å¯èƒ½éœ€è¦ä¸ºè¡¨å•æäº¤/é‡æ–°éªŒè¯å®ç°ä¼˜åŒ–ç”¨æˆ·ç•Œé¢ã€‚</p><p>å½“æ‚¨å†³å®šå°è¯• <code>defer</code> çš„æƒè¡¡æ—¶ï¼Œæˆ‘ä»¬ä¸å¸Œæœ›æ‚¨å¿…é¡»æ›´æ”¹æˆ–ç§»é™¤è¿™äº›ä¼˜åŒ–ï¼Œå› ä¸ºæˆ‘ä»¬å¸Œæœ›æ‚¨èƒ½åœ¨æ¨è¿Ÿå’Œä¸æ¨è¿ŸæŸäº›æ•°æ®ä¹‹é—´è½»æ¾åˆ‡æ¢ã€‚å› æ­¤ï¼Œæˆ‘ä»¬ç¡®ä¿æ‚¨ç°æœ‰çš„ä¹è§‚çŠ¶æ€ä»¥åŒæ ·çš„æ–¹å¼è¿è¡Œã€‚å¦‚æœæˆ‘ä»¬ä¸è¿™æ ·åšï¼Œæ‚¨å¯èƒ½ä¼šä½“éªŒåˆ°æˆ‘ä»¬æ‰€è¯´çš„ &quot;Popcorn UI&quot;ï¼Œå³æäº¤æ•°æ®ä¼šè§¦å‘å›è°ƒåŠ è½½çŠ¶æ€ï¼Œè€Œä¸æ˜¯æ‚¨è¾›è‹¦å¼€å‘çš„ä¼˜åŒ–çš„ç”¨æˆ·ç•Œé¢ã€‚</p><p>å› æ­¤ï¼Œè¯·è®°ä½è¿™ä¸€ç‚¹ï¼š<strong>å»¶è¿Ÿ 100% åªæ¶‰åŠè·¯ç”±åŠå…¶å‚æ•°çš„åˆå§‹åŠ è½½</strong>ã€‚</p><h3 id="ä¸ºä»€ä¹ˆåŠ è½½å™¨è¿”å›çš„å“åº”å¯¹è±¡ä¸å†èµ·ä½œç”¨äº†" tabindex="-1">ä¸ºä»€ä¹ˆåŠ è½½å™¨è¿”å›çš„å“åº”å¯¹è±¡ä¸å†èµ·ä½œç”¨äº†ï¼Ÿ <a class="header-anchor" href="#ä¸ºä»€ä¹ˆåŠ è½½å™¨è¿”å›çš„å“åº”å¯¹è±¡ä¸å†èµ·ä½œç”¨äº†" aria-label="Permalink to &quot;ä¸ºä»€ä¹ˆåŠ è½½å™¨è¿”å›çš„å“åº”å¯¹è±¡ä¸å†èµ·ä½œç”¨äº†ï¼Ÿ&quot;">â€‹</a></h3><p>å½“æ‚¨ä½¿ç”¨ <code>defer</code> æ—¶ï¼Œæ‚¨æ˜¯åœ¨å‘Šè¯‰ React Router ç«‹å³åŠ è½½é¡µé¢ï¼Œè€Œä¸ä½¿ç”¨å»¶è¿Ÿæ•°æ®ã€‚åœ¨è¿”å› <code>Response</code> å¯¹è±¡ä¹‹å‰ï¼Œé¡µé¢å·²ç»åŠ è½½å®Œæ¯•ï¼Œå› æ­¤å“åº”çš„è‡ªåŠ¨å¤„ç†æ–¹å¼ä¸ä½¿ç”¨ <code>return fetch(url)</code> æ—¶ä¸åŒã€‚</p><p>å› æ­¤ï¼Œæ‚¨éœ€è¦å¤„ç†è‡ªå·±çš„ <code>Response</code> è¿›ç¨‹ï¼Œå¹¶ä½¿ç”¨æ•°æ®è€Œä¸æ˜¯ <code>Response</code> å®ä¾‹æ¥è§£å†³æ‚¨çš„å»¶è¿Ÿ Promise é—®é¢˜ã€‚</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">request</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defer</span><span style="color:#E1E4E8;">({</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Broken! Resolves with a Response</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// broken: fetch(url),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#6A737D;">// Fixed! Resolves with the response data</span></span>
<span class="line"><span style="color:#E1E4E8;">    data: </span><span style="color:#B392F0;">fetch</span><span style="color:#E1E4E8;">(url).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">()),</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">request</span><span style="color:#24292E;">, </span><span style="color:#E36209;">params</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defer</span><span style="color:#24292E;">({</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Broken! Resolves with a Response</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// broken: fetch(url),</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#6A737D;">// Fixed! Resolves with the response data</span></span>
<span class="line"><span style="color:#24292E;">    data: </span><span style="color:#6F42C1;">fetch</span><span style="color:#24292E;">(url).</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">((</span><span style="color:#E36209;">res</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">()),</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div><p>æˆ–è€…è€ƒè™‘ä¸€ä¸‹æˆ‘ä»¬çš„å»¶è¿Ÿæ•°æ®ä¼šè¿”å›é‡å®šå‘ <code>Response</code> çš„æƒ…å†µã€‚æ‚¨å¯ä»¥æ£€æµ‹é‡å®šå‘å¹¶å°†çŠ¶æ€ä»£ç å’Œä½ç½®ä½œä¸ºæ•°æ®å‘é€å›æ¥ï¼Œç„¶åæ‚¨å¯ä»¥é€šè¿‡ <code>useEffect</code> å’Œ <code>useNavigate</code> åœ¨ç»„ä»¶ä¸­æ‰§è¡Œå®¢æˆ·ç«¯é‡å®šå‘ã€‚</p><div class="language-jsx vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">jsx</span><pre class="shiki github-dark vp-code-dark"><code><span class="line"><span style="color:#F97583;">async</span><span style="color:#E1E4E8;"> </span><span style="color:#F97583;">function</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">loader</span><span style="color:#E1E4E8;">({ </span><span style="color:#FFAB70;">request</span><span style="color:#E1E4E8;">, </span><span style="color:#FFAB70;">params</span><span style="color:#E1E4E8;"> }) {</span></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">let</span><span style="color:#E1E4E8;"> data </span><span style="color:#F97583;">=</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">fetch</span><span style="color:#E1E4E8;">(url).</span><span style="color:#B392F0;">then</span><span style="color:#E1E4E8;">((</span><span style="color:#FFAB70;">res</span><span style="color:#E1E4E8;">) </span><span style="color:#F97583;">=&gt;</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">if</span><span style="color:#E1E4E8;"> (res.status </span><span style="color:#F97583;">==</span><span style="color:#E1E4E8;"> </span><span style="color:#79B8FF;">301</span><span style="color:#E1E4E8;">) {</span></span>
<span class="line"><span style="color:#E1E4E8;">      </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> {</span></span>
<span class="line"><span style="color:#E1E4E8;">        isRedirect: </span><span style="color:#79B8FF;">true</span><span style="color:#E1E4E8;">,</span></span>
<span class="line"><span style="color:#E1E4E8;">        status: res.status,</span></span>
<span class="line"><span style="color:#E1E4E8;">        location: res.headers.</span><span style="color:#B392F0;">get</span><span style="color:#E1E4E8;">(</span><span style="color:#9ECBFF;">&quot;Location&quot;</span><span style="color:#E1E4E8;">),</span></span>
<span class="line"><span style="color:#E1E4E8;">      };</span></span>
<span class="line"><span style="color:#E1E4E8;">    }</span></span>
<span class="line"><span style="color:#E1E4E8;">    </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> res.</span><span style="color:#B392F0;">json</span><span style="color:#E1E4E8;">();</span></span>
<span class="line"><span style="color:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#E1E4E8;">  </span><span style="color:#F97583;">return</span><span style="color:#E1E4E8;"> </span><span style="color:#B392F0;">defer</span><span style="color:#E1E4E8;">({ data });</span></span>
<span class="line"><span style="color:#E1E4E8;">}</span></span></code></pre><pre class="shiki github-light vp-code-light"><code><span class="line"><span style="color:#D73A49;">async</span><span style="color:#24292E;"> </span><span style="color:#D73A49;">function</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">loader</span><span style="color:#24292E;">({ </span><span style="color:#E36209;">request</span><span style="color:#24292E;">, </span><span style="color:#E36209;">params</span><span style="color:#24292E;"> }) {</span></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">let</span><span style="color:#24292E;"> data </span><span style="color:#D73A49;">=</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">fetch</span><span style="color:#24292E;">(url).</span><span style="color:#6F42C1;">then</span><span style="color:#24292E;">((</span><span style="color:#E36209;">res</span><span style="color:#24292E;">) </span><span style="color:#D73A49;">=&gt;</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">if</span><span style="color:#24292E;"> (res.status </span><span style="color:#D73A49;">==</span><span style="color:#24292E;"> </span><span style="color:#005CC5;">301</span><span style="color:#24292E;">) {</span></span>
<span class="line"><span style="color:#24292E;">      </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> {</span></span>
<span class="line"><span style="color:#24292E;">        isRedirect: </span><span style="color:#005CC5;">true</span><span style="color:#24292E;">,</span></span>
<span class="line"><span style="color:#24292E;">        status: res.status,</span></span>
<span class="line"><span style="color:#24292E;">        location: res.headers.</span><span style="color:#6F42C1;">get</span><span style="color:#24292E;">(</span><span style="color:#032F62;">&quot;Location&quot;</span><span style="color:#24292E;">),</span></span>
<span class="line"><span style="color:#24292E;">      };</span></span>
<span class="line"><span style="color:#24292E;">    }</span></span>
<span class="line"><span style="color:#24292E;">    </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> res.</span><span style="color:#6F42C1;">json</span><span style="color:#24292E;">();</span></span>
<span class="line"><span style="color:#24292E;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="color:#24292E;">  </span><span style="color:#D73A49;">return</span><span style="color:#24292E;"> </span><span style="color:#6F42C1;">defer</span><span style="color:#24292E;">({ data });</span></span>
<span class="line"><span style="color:#24292E;">}</span></span></code></pre></div>`,41),e=[o];function c(t,r,E,y,i,d){return a(),n("div",null,e)}const F=s(p,[["render",c]]);export{u as __pageData,F as default};
